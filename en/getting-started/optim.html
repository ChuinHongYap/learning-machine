<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Optimization - Learning Machine</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="To do machine learning, one must learn machine.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/overview.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/funcs.html"><strong aria-hidden="true">1.1.</strong> Models</a></li><li class="chapter-item expanded "><a href="../getting-started/obj.html"><strong aria-hidden="true">1.2.</strong> Objectives</a></li><li class="chapter-item expanded "><a href="../getting-started/optim.html" class="active"><strong aria-hidden="true">1.3.</strong> Optimization</a></li><li class="chapter-item expanded "><a href="../getting-started/linear-case.html"><strong aria-hidden="true">1.4.</strong> Case Study: Linear Models</a></li><li class="chapter-item expanded "><a href="../getting-started/ccc.html"><strong aria-hidden="true">1.5.</strong> CCC</a></li></ol></li><li class="chapter-item expanded "><a href="../what-we-want/overview.html"><strong aria-hidden="true">2.</strong> What we want</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../what-we-want/correctness.html"><strong aria-hidden="true">2.1.</strong> Correctness</a></li><li class="chapter-item expanded "><a href="../what-we-want/simplicity.html"><strong aria-hidden="true">2.2.</strong> Simplicity</a></li><li class="chapter-item expanded "><a href="../what-we-want/ccc.html"><strong aria-hidden="true">2.3.</strong> CCC</a></li></ol></li><li class="chapter-item expanded "><a href="../digging-deeper/overview.html"><strong aria-hidden="true">3.</strong> Digging Deeper</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../digging-deeper/no-myths.html"><strong aria-hidden="true">3.1.</strong> No More Myths</a></li><li class="chapter-item expanded "><a href="../digging-deeper/approx.html"><strong aria-hidden="true">3.2.</strong> Approximation</a></li><li class="chapter-item expanded "><a href="../digging-deeper/ccc.html"><strong aria-hidden="true">3.3.</strong> CCC</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Learning Machine</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/r3ntru3w4n9/learning-machine/tree/master/en" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="how-to-get-a-great-function"><a class="header" href="#how-to-get-a-great-function">How to get a great function?</a></h1>
<p><em>Knowing how good something is is no good, unless we can get a good one.</em></p>
<p>We have a model. We know how good it is. Now, how do we find a good model? A naive way of trying to achieve that is to randomly choose parameters and cross our fingers and hope that the model is good enough. However, the number of possible parameters can be crazily large, so it's not always feasible solution. What is a good way to solve the problem?</p>
<h2 id="gradient-descent"><a class="header" href="#gradient-descent">Gradient descent</a></h2>
<p>Imagine you are standing on a hill. You want to find the lowest point in your region, how would you do it? You take a ball, and roll it down the hill, and naturally the ball stops at the place where the height is minimum. This is exactly what mathematicians decided to use to solve the problem. And it has a cool name. <strong>Gradient descent</strong>.</p>
<p>Wait, you ask. How is this rolling downhill related to gradient descent? Well, let's define a function which we want to optimize \(f\), and we define</p>
<p>\[z = f(x, y)\]
\[z, x, y \in R\]</p>
<p>In other words, given there is a location on the 2D plane \(xy\), the function takes in the position and output a scalar. If we say that the scalar is the height at \((x, y)\), then if we plot \((x, y, z)\) in our head, it looks like a terrain. And if we &quot;roll a ball&quot; down from any location, the ball is eventually going to find a minimum (because of physics).</p>
<p>Now let's generalize the idea. Imagine our function \(f\) is no longer limited to 2 inputs. Let's substitute \(f\) for a loss function \(L\) we discussed last chapter (the formal one). </p>
<p>The input is a function \(f\) that we want to optimize (the ball that we want to roll down the hill), and a pair of inputs \((x, y)\), given that \(n \in N\), \(x, y \in R^n\)</p>
<p>Remember that we've said over and over that the function is determined by it's parameters? To optimize a function, we optimize its parameter. In this case, <strong>the function parameters</strong> is the position of the ball, and the <strong>loss function output</strong> is the value we want to minimize.</p>
<pre><code class="language-python">
    pred_y = F(real_x)
    loss = distance(pred_y, real_y)

    # Optimize the function based on loss
    optimize_function(F)

    return loss


def optimize_function(F):
    &quot;We are doing something to `F`'s parameter and hope that the function gets better&quot;
    F.parameter = 0
</code></pre>
<p>Now we get to the gradient part. Warning: A little math here.</p>
<p>First, let's talk about what gradients are. Note that the weird upside-down triangle is the notation for gradient.</p>
<p>Let's suppose there is a function.</p>
<p>\[y = f(x_1, x_2, ... , x_n)\]
\[y, x_1, x_2 , ... , y_n, n \in R\]</p>
<p>Then we say that the gradient of \(y\):</p>
<p>\[\nabla y = \frac{\partial y}{\partial x} = (\frac{\partial y}{\partial x_1}, \frac{\partial y}{\partial x_2}, ..., \frac{\partial y}{\partial x_n})^T\]</p>
<p>If we now make the dot product of \(\nabla y\) and  a small change in \(x\), denoted by \(\Delta x\), we observe:</p>
<p>\[(\nabla y)^T(\Delta x) = \frac{\partial y}{\partial x_1}\partial x_1 + \frac{\partial y}{\partial x_2}\partial x_2 + ... + \frac{\partial y}{\partial x_n}\partial x_n = \sum_{i=1}^n \Delta y_i = \Delta y\]</p>
<!-- TODO: add more descriptions -->
<p>The multiplication of the gradient of \(y\) and a small change in \(x\) yields the change in \(y\)! This is why gradients are so useful.</p>
<p><em>You can think of gradient as the steepest way uphill.</em> If you move along the gradient, you can increase the function value the fastest, in this case, you will increase the <strong>loss</strong>. So usually we want to move in the opposite direction of the gradient at a point (remember we are minimizing the function?). If we always move to the opposite direction of the gradient, we will eventually get a (local) minimum value of the function, we call this <strong>stochastic gradient descent</strong>.</p>
<h3 id="stochastic-gradient-descent"><a class="header" href="#stochastic-gradient-descent">Stochastic gradient descent</a></h3>
<p>Stochastic gradient descent is the most common gradient descent method, and the most basic one. It involves only 3 variables, \(x, y, lr, iter\). \(x\) is your input variable, \(y\) is your output variable, and \(lr\), learning rate, is a scalar showing how far you can move in one iteration. You repeat \(iter\) iterations. For the ultimate quality we would want \(lr\) to be as small as possible (to not jump too far because you want to follow the terrain), and as many \(iter\) as possible (to ensure that the minimum is obtained). But it's not possible to do so in practice. Selecting \(lr\) and \(iter\) has become more art than science, and is often called <strong>hyperparameter tuning</strong> (parameter is for functions).</p>
<pre><code class="language-python">def sgd_once(x, y, lr):
    &quot;&quot;&quot;
    sgd stands for stochastic gradient descent.
    It moves in the direct opposite of the gradient.
    lr means learning rate.
    It is a small number because we don't want to move too far in a step.
    &quot;&quot;&quot;
    loss = loss_func(x, y)

    # This is the gradient descent step
    x -= lr * 2.0 * (x - y)

    new_loss = loss_func(x, y)

    # A successful step should mean that we get a smaller new loss
    assert new_loss &lt; loss


def sgd(x: ndarray, y: ndarray, lr: float, iter: int):
    &quot;&quot;&quot;
    A real sgd flow doesn't just make one step.
    It usually updates for several hundreds or even thousands of iterations
    &quot;&quot;&quot;
    for _ in range(iter):
        sgd_once(x, y, lr)
</code></pre>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>We choose an initial <strong>function</strong> by selecting a parameter (randomly), then optimize it by gradient descent, the value we want to reduce is the <strong>loss</strong>, and the parameters we want to choose is the <strong>function's parameters</strong>. Gradient descent is a lot like rolling balls down the hills, in which the ball will find the lowest point, which is the minimum.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../getting-started/obj.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../getting-started/linear-case.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../getting-started/obj.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../getting-started/linear-case.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        
        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
